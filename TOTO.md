# 函数志 - 功能完善 TODO LIST

基于对项目的全面分析，以下是需要完善的功能清单。

---

## 🔴 高优先级（安全/核心问题）

### 1. 认证系统安全漏洞 ✅ 已完成

- [x] **移除硬编码密码** - 已使用环境变量存储凭证
- [x] 实现真正的认证系统（NextAuth.js + JWT）
- [x] API 路由添加身份验证中间件保护
- [x] 实现密码加密存储（bcrypt）

> **实现说明**:
> - 使用 NextAuth.js 实现完整的认证系统
> - 管理员凭证通过环境变量配置 (`ADMIN_EMAIL`, `ADMIN_PASSWORD_HASH`)
> - 密码使用 bcrypt 加密存储
> - 所有 `/api/admin/*` 路由都受到认证保护
> - 参考 `.env.example` 配置环境变量
> - 使用 `scripts/hash-password.ts` 生成密码哈希

### 2. 评论系统安全 ✅ 已完成

- [x] 添加垃圾评论防护（验证码/reCAPTCHA）
- [x] 添加评论内容 XSS 过滤
- [x] 实现评论频率限制

> **实现说明**:
> - 使用 Google reCAPTCHA v3 实现隐形验证码防护
> - 使用 sanitize-html 库进行 XSS 过滤，移除所有 HTML 标签
> - 添加可疑内容检测（脚本注入、SQL 注入、垃圾链接等）
> - 实现增强的频率限制（每分钟3条，超限后封禁10分钟）
> - 参考 `.env.example` 配置 reCAPTCHA 密钥
> - 相关文件：`lib/sanitize.ts`, `lib/recaptcha.ts`, `lib/rate-limit.ts`

---

## 🟡 中优先级（功能完善）

### 3. 教程模块

- [ ] 实现教程内容管理系统（目前 `courses/page.tsx` 只是占位符）
- [ ] 支持系列教程/课程章节
- [ ] 添加学习进度追踪

### 4. 评论管理

- [ ] 添加管理后台评论审核页面
- [ ] 实现评论回复功能（嵌套评论）
- [ ] 添加评论删除/编辑功能

### 5. 管理后台增强

- [ ] 添加访问统计分析仪表板
- [ ] 添加标签管理页面（增删改）
- [ ] 添加评论管理页面
- [ ] 实现文章浏览量统计（views 字段已有，但未实现增量逻辑）

### 6. 文章功能增强

- [ ] 实现相关文章推荐
- [ ] 实现系列文章导航（schema 中有 series 字段但未使用）
- [ ] 添加文章归档页面（按年/月分类）
- [ ] 实现文章点赞功能

---

## 🟢 低优先级（体验优化）

### 7. 用户体验

- [ ] 添加阅读进度指示器
- [ ] 添加文章收藏功能
- [ ] 实现骨架屏 loading 状态
- [ ] 代码高亮主题切换（亮色/暗色）
- [ ] 添加回到顶部按钮

### 8. SEO 和性能

- [ ] 配置 Next.js Image 优化
- [ ] 添加 PWA 支持
- [ ] 实现增量静态再生成 (ISR) 优化

### 9. 社交功能

- [ ] 实现 Newsletter 订阅功能
- [ ] 添加文章阅读量显示
- [ ] 集成社交媒体分享统计

### 10. 国际化

- [ ] 添加多语言支持 (i18n)
- [ ] 英文界面翻译

---

## 📊 问题统计

| 类别 | 数量 | 已完成 | 紧急程度 |
|------|------|--------|----------|
| 安全问题 | 7 | 7 | 🔴 高 ✅ |
| 功能缺失 | 12 | 0 | 🟡 中 |
| 体验优化 | 8 | 0 | 🟢 低 |
| **总计** | **27** | **7** | - |

---

## 💡 建议

~~优先处理认证系统的安全问题，特别是 `LoginModal.tsx` 中的硬编码密码需要立即修复。~~ ✅ 已完成

### 推荐实施顺序

1. **第一阶段**：~~修复安全漏洞~~ ✅ 全部完成
2. **第二阶段**：完善核心功能（评论管理、文章增强）- 进行中
3. **第三阶段**：教程模块开发
4. **第四阶段**：体验优化和国际化（持续迭代）

---

## 📝 更新日志

### 2025-12-01
- ✅ 完成认证系统安全修复
  - 集成 NextAuth.js
  - 移除硬编码密码，改用环境变量
  - 实现 bcrypt 密码加密
  - 添加 API 路由认证中间件

- ✅ 完成评论系统安全加固
  - 集成 Google reCAPTCHA v3 防止垃圾评论
  - 使用 sanitize-html 实现 XSS 过滤
  - 添加可疑内容模式检测
  - 实现增强的 IP 频率限制（3次/分钟，超限封禁10分钟）
  - 新增文件：`lib/sanitize.ts`, `lib/recaptcha.ts`, `lib/rate-limit.ts`
